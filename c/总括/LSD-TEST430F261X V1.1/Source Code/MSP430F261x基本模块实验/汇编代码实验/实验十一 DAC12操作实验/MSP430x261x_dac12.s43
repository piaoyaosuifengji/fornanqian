;*******************************************************************************
; 版权:   杭州利尔达科技有限公司
; 文件名:MSP430F261x_DAC12.s43
; 版本：V1.0
; 工作环境:IAR Embedded Workbench Evaluation for MSP430 4.10A
; 作者:Huanglongsong
; 描述：基于MSP430F261x内部DAC12模块，使用内部ADC12REF(2.5V)参考源，待电源电压稳定后，
;       向DAC12_0DAT写入一值，经转换后从DAC0(P6.6)端输出(约1.0V左右)
;
;
;               
;                MSP430F261x
;             -----------------
;         /|\|              XIN|-
;          | |                 | 32kHz
;          --|RST          XOUT|-
;            |                 |
;            |        DAC0/P6.6|--> 1V
;            |                 |
;
;
;
;*******************************************************************************
#include "msp430x26x.h"
;-------------------------------------------------------------------------------
            RSEG    CSTACK                  ; 停看门狗
;-------------------------------------------------------------------------------
            RSEG    CODE                    ; 定义程序段
;-------------------------------------------------------------------------------
RESET       mov.w   #SFE(CSTACK),SP         ; 初始化堆栈指针
StopWDT     mov.w   #WDTPW+WDTHOLD,&WDTCTL  ; 停止开门狗
SetupADC12  mov.w   #REF2_5V+REFON,&ADC12CTL0 ; 打开内部基准(2.5V)
            mov.w   #13600,&TACCR0          ; 等待电源稳定所需时间
            bis.w   #CCIE,&TACCTL0          ; 开比较模式中断
            mov.w   #TACLR+MC_1+TASSEL_2,&TACTL; 增计数模式, SMCLK
            bis.w   #LPM0+GIE,SR            ; 进入LPM0,开总中断
            bic.w   #CCIE,&TACCTL0          ; 关计数器中断
            dint                            ; 关总中断
SetupDAC120 mov.w   #DAC12IR+DAC12AMP_5+DAC12ENC,&DAC12_0CTL  ; 使用内部DAC0并初始化
            mov.w   #0666h,&DAC12_0DAT      ; 1.0V (2.5V = 0x0FFFh)
                                            ;
Mainloop    bis.w   #LPM0,SR                ; 关CPU,处于待机模式
            nop                             ; 仅在调试时使用
                                            ;
;-------------------------------------------------------------------------------
TIMERA0_ISR;
;-------------------------------------------------------------------------------
            clr.w   &TACTL                  ; 清Timer_A定时器值
            bic.w   #LPM0,0(SP)             ; 退出低功耗模式0
            reti                            ;
;-------------------------------------------------------------------------------
            COMMON  INTVEC                  ; 中断相量表
;-------------------------------------------------------------------------------
            ORG     TIMERA0_VECTOR          ; Timer_A0 相量地址
            DW      TIMERA0_ISR
            ORG     RESET_VECTOR            ; 系统上电复位地址
            DW      RESET
            END
