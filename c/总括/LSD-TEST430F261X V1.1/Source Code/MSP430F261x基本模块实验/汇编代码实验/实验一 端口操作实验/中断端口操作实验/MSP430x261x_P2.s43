;*******************************************************************************
; 版权:   杭州利尔达科技有限公司
; 文件名:MSP430F261x_P2.S43
; 版本：V1.0
; 工作环境:IAR Embedded Workbench Evaluation for MSP430 4.10A
; 作者:Huanglongsong 
; 描述：按键中断实验例程，初始化P2.5(Enter键)为输入模式，内部电阻上拉，下降沿中
;       断有效，系统进入LPM4,当按下Enter键后，进入中断服务子程式序，改变一次LED状态
; 生成日期:2008年11月
;  ACLK = n/a, MCLK = SMCLK = default DCO
;
;                MSP430F261x
;             -----------------
;         /|\|                 |
;          | |                 |
;          --|RST              |
;      /|\   |                 |
;       --o--|P2.5         P5.7|-->LED
;      \|/
;
;******************************************************************************/
#include  <msp430x26x.h>
;-------------------------------------------------------------------------------
            RSEG    CSTACK                  ; 定义堆栈段
;-------------------------------------------------------------------------------
            RSEG    CODE                    ; 定义程序段
;-----------------------------------------------------------------------------
RESET       mov.w   #SFE(CSTACK),SP         ; 初始化堆栈指针
StopWDT     mov.w   #WDTPW+WDTHOLD,&WDTCTL  ; 停止开门狗
SetupP5     bis.b   #BIT7,&P5DIR            ; P5.7输出模式
            bis.b   #BIT5,&P2OUT            ; P2.5输出高
            bis.b   #BIT5,&P2REN            ; P2.5内部电阻上拉
            bis.b   #BIT5,&P2IE             ; P2.5 中断使能
            bis.b   #BIT5,&P2IES            ; P2.5 下降沿触发
            bic.b   #BIT5,&P2IFG            ; P2.5 IFG 清除
                                            ;
Mainloop    bis.w   #LPM4+GIE,SR            ; 进入LPM4, 开总中断
            nop                             ; 仅调试时使用
                                            ;
;-----------------------------------------------------------------------------
P2_ISR     ; Toggle P1.0 Output
;-----------------------------------------------------------------------------
            xor.b   #BIT7,&P5OUT            ; P2.4 下降沿触发翻转一次P5.7
            bic.b   #BIT5,&P2IFG            ; P2.4 IFG 清除
            reti                            ; 中断函数返回
                                            ;
;-----------------------------------------------------------------------------
            COMMON  INTVEC                  ; 中断相量入口
;-----------------------------------------------------------------------------
            ORG     RESET_VECTOR            ; MSP430 复位相量入口地址
            DW      RESET                   ;
            ORG     PORT2_VECTOR            ; P2.x 中断相量入口
            DW      P2_ISR                  ;
            END
