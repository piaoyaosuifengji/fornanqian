;*******************************************************************************
; 版权:   杭州利尔达科技有限公司
; 文件名:MSP430F261x_WDT.s43
; 版本：V1.0
; 工作环境:IAR Embedded Workbench Evaluation for MSP430 4.10A
; 作者:Huanglongsong 
; 描述：MSP430系列WDT模块实验例程，配置WDT为定时器模式，间隔1S改变一次Led状态
;  ACLK = LFXT1/4 = 32768/4, MCLK = SMCLK = default DCO ~1.045MHz
; 生成日期:2008年11月
;
;                 MSP430F261x
;             -----------------
;         /|\|              XIN|-
;          | |                 | 32kHz
;          --|RST          XOUT|-
;            |                 |
;            |             P5.7|-->LED
;
;
;*******************************************************************************
#include "msp430x26x.h"
;-------------------------------------------------------------------------------
            RSEG    CSTACK                  ; 定义堆栈段
;-------------------------------------------------------------------------------
            RSEG    CODE                    ; 定义程序段
;-------------------------------------------------------------------------------
RESET       mov.w   #SFE(CSTACK),SP         ; 初始化堆栈
SetupWDT    mov.w   #WDT_ADLY_250,&WDTCTL   ;WDT的时钟源自ACLK，经分频后得到4HZ的时钟
            bis.b   #WDTIE,&IE1             ; 开WDT定时器中断
SetupP1     bis.b   #BIT7,&P5DIR            ; 设置P5.7为输出模式
                                            ;
Mainloop    bis.w   #LPM3+GIE,SR            ; 开中断，系统进入低功耗模式3
            nop                             ; 仅调试时使用
                                            ;
;-------------------------------------------------------------------------------
WDT_ISR;   
;-------------------------------------------------------------------------------
            xor.b   #BIT7,&P5OUT            ; 触发取反一次P5.7的输出状态
            reti                            ;
                                          ;
;-------------------------------------------------------------------------------
            COMMON  INTVEC                  ; 中断相量表
;-------------------------------------------------------------------------------
            ORG     RESET_VECTOR            ; MSP430 复位地址
            DW      RESET                   ;
            ORG     WDT_VECTOR              ; 看门狗中断入口地址
            DW      WDT_ISR                 ;
            END
