/*******************************************************************************
// 版权:   杭州利尔达科技有限公司
// 文件名:MSP430x261x_rosc.S43
// 版本：V1.0
// 工作环境:IAR Embedded Workbench Evaluation for MSP430 4.10A
// 作者:Huanglongsong
// 描述：通过外部电阻调节内部DCO的电流源，改变电流的大小DCO的频率随之变化，MCLK默认
//      选择DCO直接通过P5.4输出，可以通过示波器或者频率计测试DCO的频率随外部电阻的变
//      化而变化。同时，P5.7口上的LED闪烁也随之改变。
//  R=100K -> ~2MHz (参考器件手据手册)
// 生成日期:2008年12月
//
//               MSP430F261x
//            -----------------
//   /|\  /|\|              XIN|-
//    |    | |                 |
//    R    --|RST          XOUT|-
//    |      |                 |
//    -------|P2.5/ROSC    P5.7|-->LED
//           |        P5.4/MCLK|-->MCLK = DCOCLK
//
//
******************************************************************************/
#include "msp430x26x.h"
;-------------------------------------------------------------------------------
            RSEG    CSTACK                  ; 定义堆栈区
;-------------------------------------------------------------------------------
            RSEG    CODE                    ; 定义程序区
;-------------------------------------------------------------------------------
RESET       mov.w   #SFE(CSTACK),SP         ; 初始化堆栈区
StopWDT     mov.w   #WDTPW+WDTHOLD,&WDTCTL  ; 关闭看门狗
SetupBC     bis.b   #DCOR,&BCSCTL2          ; 选择外部电阻调节DCO
            bic.b   #RSEL1+RSEL0,&BCSCTL1   ; RSEL = 4
            bis.w   #OSCOFF,SR              ; XT1关闭
SetupP1     bis.b   #BIT4 + BIT7,&P5DIR     ; P5.7 输出
            bis.b   #BIT4,&P5SEL            ; MCLK 对外
                                            ;
Mainloop    bis.b   #BIT7,&P5OUT            ; P5.7 = 1
            call    #Delay                  ; 延时
            bic.b   #BIT7,&P5OUT            ; P5.7 = 0
            call    #Delay                  ; 延时
            jmp     Mainloop                ; 
;-------------------------------------------------------------------------------
; 延时子函数
;-------------------------------------------------------------------------------            
Delay       mov.w   #0ffFFh,R11             ; 
Delay1      dec     R11                            
            jnz     Delay1           
            ret    
;-------------------------------------------------------------------------------
; 中断向量
;-------------------------------------------------------------------------------
            COMMON  INTVEC
            ORG     RESET_VECTOR            ; 复位向量
            DW      RESET                   ;
            END