/*******************************************************************************
// 版权:   杭州利尔达科技有限公司
// 文件名:MSP430x261x_tb.c
// 版本：V1.0
// 工作环境:IAR Embedded Workbench Evaluation for MSP430 4.10A
// 作者:Huanglongsong
// 描述：Timer_B演示，TB初始化为连续计数模式，CPU被禁止，TBR的时钟来自ACLK(32768HZ),
//      当TBR从50000开始计数到0xFFFF时，产生一次中断，中断服务子程序中取反一
//      次LED状态。
// 生成日期:2008年11月
//
//           MSP430F261x
//         ---------------
//     /|\|            XIN|-
//      | |               | 32kHz
//      --|RST        XOUT|-
//        |               |
//        |           P5.7|-->LED
//
//
******************************************************************************/
#include "msp430x26x.h"

;-------------------------------------------------------------------------------
            RSEG    CSTACK                  ; 定义堆栈区
;-------------------------------------------------------------------------------
            RSEG    CODE                    ; 定义程序段
;-------------------------------------------------------------------------------
RESET       mov.w   #SFE(CSTACK),SP         ; 初始化堆栈
StopWDT     mov.w   #WDTPW+WDTHOLD,&WDTCTL  ; 关闭看门狗
SetupP5     bis.b   #BIT7, &P5DIR           ; 设置P5.7输出
            bic.b   #BIT7, &P5OUT
            mov.w   #50000,TBR               ; TBR赋值
            mov.w   #TBSSEL_1 + MC_2 + TBIE+TBCLR, &TBCTL 
                             ; ACLK,连续计数模式，溢出中断使能
                                            ;
Mainloop    bis.w   #CPUOFF+GIE,SR          ; CPU 关闭
            nop                             ; 
                                            ;
;-------------------------------------------------------------------------------
; Timer_B中断向量
;-------------------------------------------------------------------------------
TBX_ISR            
            add.w   &TBIV,PC                ; 
            reti                            ;
            reti                            ; 
            reti                            ; 
            reti                            ;
            reti                            ;
            reti                            ;
            reti                            ;
TB_over     xor.b   #BIT7,&P5OUT            ; P5.7取反
            mov.w   #50000,TBR
            bic.w   #TBIFG,&TBCTL
            reti                            ; 
                                            ;
;-------------------------------------------------------------------------------
; 中断向量
;-------------------------------------------------------------------------------
            COMMON  INTVEC
            ORG     RESET_VECTOR            ; 复位向量
            DW      RESET                   ;
            ORG     TIMERB1_VECTOR          ; TB中断向量
            DW      TBX_ISR                 ;
            END
